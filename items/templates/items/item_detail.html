{% extends 'items/base.html' %}
{% block title %}{{ item.title }}{% endblock %}
{% block content %}
<div class="row">
<div class="col-md-8">
<div class="card shadow-sm border-0 mb-4">
{% if item.image %}
<img src="{{ item.image.url }}" class="card-img-top detail-img" alt="{{ item.title }}">
{% endif %}
<div class="card-body p-4">
<div class="d-flex flex-wrap gap-1 mb-3">
{% if item.item_type == 'lost' %}
<span class="badge bg-danger fs-6">

{{ item.get_item_type_display }}
</span>
{% else %}
<span class="badge bg-success fs-6">

{{ item.get_item_type_display }}
</span>
{% endif %}
<span class="badge bg-secondary">
{{ item.get_category_display }}
</span>
{% if item.status == 'open' %}
<span class="badge bg-info">
{{ item.get_status_display }}
</span>
{% elif item.status == 'claimed' %}
<span class="badge bg-warning">
{{ item.get_status_display }}
</span>
{% else %}
<span class="badge bg-success">
{{ item.get_status_display }}
</span>
{% endif %}
</div>
<h2 class="fw-bold">{{ item.title }}</h2>
<p class="text-muted mt-3">{{ item.description }}</p>
<hr>
<div class="row text-muted small">
<div class="col-sm-6 mb-2">

<strong>Location:</strong> {{ item.location }}
</div>
<div class="col-sm-6 mb-2">

<strong>Date:</strong> {{ item.date_item }}
</div>
<div class="col-sm-6 mb-2">

<strong>Posted by:</strong> {{ item.posted_by }}
</div>
<div class="col-sm-6 mb-2">

<strong>Reported:</strong> {{ item.date_reported }}
</div>
</div>
{% if user == item.posted_by %}
<hr>
<form method="post" action="{% url 'delete_item' item.id %}" class="d-inline" onsubmit="return confirm('Delete this item?');">
{% csrf_token %}
<button class="btn btn-outline-danger btn-sm">
Delete Item
</button>
</form>
{% endif %}
</div>
</div>
</div>
<div class="col-md-4">
{% if user.is_authenticated and user != item.posted_by and not user_has_claimed and item.status == 'open' %}
<div class="card shadow-sm border-0 mb-4">
<div class="card-body p-4">
<h5 class="fw-bold mb-3">
Claim this Item
</h5>
<form method="post" action="{% url 'claim_item' item.id %}">
{% csrf_token %}
<div class="mb-3">
<label for="id_message" class="form-label">Your Message</label>
<textarea name="message" id="id_message" class="form-control" rows="3" placeholder="Describe why this is yours..." required></textarea>
</div>
<button type="submit" class="btn btn-primary w-100">
Submit Claim
</button>
</form>
</div>
</div>
{% elif user_has_claimed %}
<div class="alert alert-info">
You already submitted a claim.
</div>
{% elif not user.is_authenticated %}
<div class="card shadow-sm border-0 mb-4">
<div class="card-body text-center p-4">
<p class="text-muted">Login to claim this item</p>
<a href="{% url 'login' %}?next={% url 'item_detail' item.id %}" class="btn btn-primary">
Login
</a>
</div>
</div>
{% endif %}
{% if user == item.posted_by and claims %}
<div class="card shadow-sm border-0">
<div class="card-body p-4">
<h5 class="fw-bold mb-3">
Claims ({{ claims|length }})
</h5>
{% for claim in claims %}
<div class="border rounded p-3 mb-3 {% if claim.is_approved %}bg-success bg-opacity-10{% endif %}">
<div class="d-flex justify-content-between align-items-center mb-2">
<strong>{{ claim.claimed_by }}</strong>
{% if claim.is_approved %}
<span class="badge bg-success">
Approved
</span>
{% else %}
<span class="badge bg-warning">Pending</span>
{% endif %}
</div>
<p class="small text-muted mb-2">{{ claim.message }}</p>
<small class="text-muted">{{ claim.date_claimed }}</small>
{% if not claim.is_approved %}
<form method="post" action="{% url 'approve_claim' claim.id %}" class="mt-2">
{% csrf_token %}
<button class="btn btn-success btn-sm w-100">
Approve
</button>
</form>
{% endif %}
</div>
{% endfor %}
</div>
</div>
{% endif %}
</div>
</div>
<a href="{% url 'item_list' %}" class="btn btn-outline-secondary mt-3">
Back to Items
</a>
{% endblock %}
